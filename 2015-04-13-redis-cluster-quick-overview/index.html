<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=cache-control content="max-age=0"><meta http-equiv=cache-control content="no-cache"><meta http-equiv=expires content="0"><meta http-equiv=expires content="Tue, 01 Jan 1980 1:00:00 GMT"><meta http-equiv=pragma content="no-cache"><link rel=apple-touch-icon-precomposed sizes=192x192 href=/icon-192x192.png><link rel="shortcut icon" href=/favicon.ico><link rel=preconnect href=https://fonts.googleapis.com crossorigin><link rel=preload href="https://fonts.googleapis.com/css2?family=Inter&display=swap" onload='this.onload=null,this.rel="stylesheet",this.removeAttribute("as")' as=style><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Inter&display=swap"></noscript><meta name=description content="Redis Cluster. Quick overview."><title>Redis Cluster. Quick overview.</title>





<link rel="stylesheet" href="/css/main.c8826345ad7ba562c619be2596e20207fe470ef61aecf9db4c6405371222040f.css" integrity="sha256-yIJjRa17pWLGGb4lluICB/5HDvYa7PnbTGQFNxIiBA8=" crossorigin="anonymous">





</head><body class="m-auto px-4 xl:pl-80 font-inter dark:bg-gray-900 text-black dark:text-gray-400"><nav class="pt-5 pb-5"><ul class="flex flex-row items-center justify-start"><li class=pr-3><a class="text-blue-500 hover:underline dark:text-blue-300" href=/>Home</a></li><li class=pr-3><a class="text-blue-500 hover:underline dark:text-blue-300" href=https://github.com/iliabylich>GitHub</a></li><li class=pr-3><a class="text-blue-500 hover:underline dark:text-blue-300" href=https://twitter.com/IlyaBylich>Twitter</a></li><li class=pr-3><a class="text-blue-500 hover:underline dark:text-blue-300" href=mailto:ibylich@gmail.com>Email me</a></li><li class=pr-3><a class="text-blue-500 hover:underline dark:text-blue-300" href=/index.xml>RSS</a></li></ul></nav><div class=pb-2><h1 class="font-bold text-2xl pb-5">Redis Cluster. Quick overview.</h1><span>Apr 13, 2015</span></div><aside class="relative bg-gray-200 border-1 p-6 border-black dark:bg-gray-800 xl:dark:bg-transparent xl:fixed xl:left-1 xl:top-1 xl:w-80 xl:bg-transparent xl:border-0 xl:text-xs"><a class="block hover:underline pl-0" href=#setup>Setup
</a><a class="block hover:underline pl-0" href=#cluster-configuration>Cluster configuration
</a><a class="block hover:underline pl-0" href=#connecting-nodes>Connecting nodes
</a><a class="block hover:underline pl-0" href=#testing-our-cluster>Testing our cluster
</a><a class="block hover:underline pl-0" href=#benchmarks>Benchmarks
</a><a class="block hover:underline pl-0" href=#testing-the-failover>Testing the failover
</a><a class="block hover:underline pl-0" href=#conclusion>Conclusion
</a><a class="block hover:underline pl-0" href=#links>Links</a></aside><main><p>Today I have tested version 3.0.0 of Redis server which includes Redis cluster. Here are some first thoughts about this.</p><h1 id=setup class="text-4xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Setup
<a href=#setup>#</a></h1><p>Here are my servers:</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span># 212.71.252.54  / 192.168.171.141 / node1
</span></span><span style=display:flex><span># 176.58.103.254 / 192.168.171.142 / node2
</span></span><span style=display:flex><span># 178.79.153.89  / 192.168.173.227 / node3</span></span></pre></div><p>Local hosts (on each server):</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span># local hosts
</span></span><span style=display:flex><span>192.168.171.141 node1
</span></span><span style=display:flex><span>192.168.171.142 node2
</span></span><span style=display:flex><span>192.168.173.227 node3</span></span></pre></div><p>And remote (on my PC):</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span># remote hosts
</span></span><span style=display:flex><span>212.71.252.54  node1
</span></span><span style=display:flex><span>176.58.103.254 node2
</span></span><span style=display:flex><span>178.79.153.89  node3</span></span></pre></div><p>First of all, let&rsquo;s download and extract it (on each node).</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>$ mkdir build <span style=color:#f92672>&amp;&amp;</span> cd build
</span></span><span style=display:flex><span>$ wget http://download.redis.io/releases/redis-3.0.0.tar.gz
</span></span><span style=display:flex><span>$ tar -xvzf redis-3.0.0.tar.gz
</span></span><span style=display:flex><span>$ cd redis-3.0.0/</span></span></pre></div><p>Now we can build it</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>$ apt-get install -y make gcc build-essential
</span></span><span style=display:flex><span>$ make MALLOC<span style=color:#f92672>=</span>libc <span style=color:#75715e># also jemalloc can be used</span></span></span></pre></div><p>Let&rsquo;s run tests</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>$ apt-get install -y tk8.5 tcl8.5
</span></span><span style=display:flex><span>$ make test
</span></span><span style=display:flex><span><span style=color:#75715e># a lot of output, should be green</span></span></span></pre></div><p>Then we can start Redis</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>$ src/redis-server ./redis.conf</span></span></pre></div><h1 id=cluster-configuration class="text-4xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Cluster configuration
<a href=#cluster-configuration>#</a></h1><p>We need to update our configuration file for each node</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span># redis.conf
</span></span><span style=display:flex><span>bind node1 # for node1
</span></span><span style=display:flex><span>cluster-enabled yes
</span></span><span style=display:flex><span>cluster-config-file nodes-6379.conf
</span></span><span style=display:flex><span>cluster-node-timeout 5000</span></span></pre></div><p>Here&rsquo;s what should displayed:</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>29338:M 13 Apr 21:05:00.214 * No cluster configuration found, I&#39;m a1eec932d923b55e23a5fe6a488ed7a97e27c826
</span></span><span style=display:flex><span>                _._
</span></span><span style=display:flex><span>           _.-``__ &#39;&#39;-._
</span></span><span style=display:flex><span>      _.-``    `.  `_.  &#39;&#39;-._           Redis 3.0.0 (00000000/0) 64 bit
</span></span><span style=display:flex><span>  .-`` .-```.  ```\/    _.,_ &#39;&#39;-._
</span></span><span style=display:flex><span> (    &#39;      ,       .-`  | `,    )     Running in cluster mode
</span></span><span style=display:flex><span> |`-._`-...-` __...-.``-._|&#39;` _.-&#39;|     Port: 6379
</span></span><span style=display:flex><span> |    `-._   `._    /     _.-&#39;    |     PID: 29338
</span></span><span style=display:flex><span>  `-._    `-._  `-./  _.-&#39;    _.-&#39;
</span></span><span style=display:flex><span> |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|
</span></span><span style=display:flex><span> |    `-._`-._        _.-&#39;_.-&#39;    |           http://redis.io
</span></span><span style=display:flex><span>  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;
</span></span><span style=display:flex><span> |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|
</span></span><span style=display:flex><span> |    `-._`-._        _.-&#39;_.-&#39;    |
</span></span><span style=display:flex><span>  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;
</span></span><span style=display:flex><span>      `-._    `-.__.-&#39;    _.-&#39;
</span></span><span style=display:flex><span>          `-._        _.-&#39;
</span></span><span style=display:flex><span>              `-.__.-&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>29338:M 13 Apr 21:05:00.246 # Server started, Redis version 3.0.0
</span></span><span style=display:flex><span>29338:M 13 Apr 21:05:00.247 * DB loaded from disk: 0.000 seconds
</span></span><span style=display:flex><span>29338:M 13 Apr 21:05:00.247 * The server is now ready to accept connections on port 6379</span></span></pre></div><p>Quite a lot of noisy debug information, but here is one line that is extremely important:</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>No cluster configuration found, I&#39;m a1eec932d923b55e23a5fe6a488ed7a97e27c826</span></span></pre></div><p>So, our Redis server is running in cluster mode (&mldr; repeating same steps on other nodes &mldr;)</p><h1 id=connecting-nodes class="text-4xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Connecting nodes
<a href=#connecting-nodes>#</a></h1><p>Now we have 3 nodes:</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>node1:6379
</span></span><span style=display:flex><span>node2:6379
</span></span><span style=display:flex><span>node3:6379</span></span></pre></div><p>Let&rsquo;s connect them! Redis has a tool for connecting nodes called <code>redis-trib.rb</code>. And yes, it&rsquo;s a ruby script and it requires <code>redis</code> gem to be installed (not a problem in my case).</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>$ src/redis-trib.rb
</span></span><span style=display:flex><span>Usage: redis-trib &lt;command&gt; &lt;options&gt; &lt;arguments ...&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  create          host1:port1 ... hostN:portN
</span></span><span style=display:flex><span>                  --replicas &lt;arg&gt;
</span></span><span style=display:flex><span>  check           host:port
</span></span><span style=display:flex><span>  fix             host:port
</span></span><span style=display:flex><span>  reshard         host:port
</span></span><span style=display:flex><span>                  --from &lt;arg&gt;
</span></span><span style=display:flex><span>                  --to &lt;arg&gt;
</span></span><span style=display:flex><span>                  --slots &lt;arg&gt;
</span></span><span style=display:flex><span>                  --yes
</span></span><span style=display:flex><span>  add-node        new_host:new_port existing_host:existing_port
</span></span><span style=display:flex><span>                  --slave
</span></span><span style=display:flex><span>                  --master-id &lt;arg&gt;
</span></span><span style=display:flex><span>  del-node        host:port node_id
</span></span><span style=display:flex><span>  set-timeout     host:port milliseconds
</span></span><span style=display:flex><span>  call            host:port command arg arg .. arg
</span></span><span style=display:flex><span>  import          host:port
</span></span><span style=display:flex><span>                  --from &lt;arg&gt;
</span></span><span style=display:flex><span>  help            <span style=color:#f92672>(</span>show this help<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>For check, fix, reshard, del-node, set-timeout you can specify the host and port of any working node in the cluster.</span></span></pre></div><p>For some reason, this tool does not support host names, we have to pass IP addresses manually.</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>$ src/redis-trib.rb create 192.168.171.141:6379 192.168.171.142:6379 192.168.173.227:6379
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt;&gt;&gt; Creating cluster
</span></span><span style=display:flex><span>Connecting to node 192.168.171.141:6379: OK
</span></span><span style=display:flex><span>Connecting to node 192.168.171.142:6379: OK
</span></span><span style=display:flex><span>Connecting to node 192.168.173.227:6379: OK
</span></span><span style=display:flex><span>&gt;&gt;&gt; Performing hash slots allocation on <span style=color:#ae81ff>3</span> nodes...
</span></span><span style=display:flex><span>Using <span style=color:#ae81ff>3</span> masters:
</span></span><span style=display:flex><span>192.168.171.141:6379
</span></span><span style=display:flex><span>192.168.171.142:6379
</span></span><span style=display:flex><span>192.168.173.227:6379
</span></span><span style=display:flex><span>M: 78a5bbdcd545848be8a66126a71dc69dd6d23bc4 192.168.171.141:6379
</span></span><span style=display:flex><span>   slots:0-5460 <span style=color:#f92672>(</span><span style=color:#ae81ff>5461</span> slots<span style=color:#f92672>)</span> master
</span></span><span style=display:flex><span>M: 1f6ed2478b461539f76b0b627de2e1b8565df719 192.168.171.142:6379
</span></span><span style=display:flex><span>   slots:5461-10922 <span style=color:#f92672>(</span><span style=color:#ae81ff>5462</span> slots<span style=color:#f92672>)</span> master
</span></span><span style=display:flex><span>M: 7a092b06c8c75e98176b7612e74d2e89e8b3eda7 192.168.173.227:6379
</span></span><span style=display:flex><span>   slots:10923-16383 <span style=color:#f92672>(</span><span style=color:#ae81ff>5461</span> slots<span style=color:#f92672>)</span> master
</span></span><span style=display:flex><span>Can I set the above configuration? <span style=color:#f92672>(</span>type <span style=color:#e6db74>&#39;yes&#39;</span> to accept<span style=color:#f92672>)</span>:</span></span></pre></div><p>Looks beautiful! Each node is responsible for 1/3 of data. Typing &lsquo;yes&rsquo;&mldr;</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>&gt;&gt;&gt; Nodes configuration updated
</span></span><span style=display:flex><span>&gt;&gt;&gt; Assign a different config epoch to each node
</span></span><span style=display:flex><span>&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster
</span></span><span style=display:flex><span>Waiting for the cluster to join.
</span></span><span style=display:flex><span>&gt;&gt;&gt; Performing Cluster Check (using node 127.0.0.1:7001)
</span></span><span style=display:flex><span>M: 78a5bbdcd545848be8a66126a71dc69dd6d23bc4 192.168.171.141:6379
</span></span><span style=display:flex><span>   slots:0-5460 (5461 slots) master
</span></span><span style=display:flex><span>M: 1f6ed2478b461539f76b0b627de2e1b8565df719 192.168.171.142:6379
</span></span><span style=display:flex><span>   slots:5461-10922 (5462 slots) master
</span></span><span style=display:flex><span>M: 7a092b06c8c75e98176b7612e74d2e89e8b3eda7 192.168.173.227:6379
</span></span><span style=display:flex><span>   slots:10923-16383 (5461 slots) master
</span></span><span style=display:flex><span>[OK] All nodes agree about slots configuration.
</span></span><span style=display:flex><span>&gt;&gt;&gt; Check for open slots...
</span></span><span style=display:flex><span>&gt;&gt;&gt; Check slots coverage...
</span></span><span style=display:flex><span>[OK] All 16384 slots covered.</span></span></pre></div><p>That&rsquo;s it!</p><h1 id=testing-our-cluster class="text-4xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Testing our cluster
<a href=#testing-our-cluster>#</a></h1><p>Here is how to check the status of the cluster:</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>$ src/redis-cli -h node2 cluster nodes
</span></span><span style=display:flex><span>7a092b06c8c75e98176b7612e74d2e89e8b3eda7 node1:6379 master - <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1428949630273</span> <span style=color:#ae81ff>3</span> connected 10923-16383
</span></span><span style=display:flex><span>78a5bbdcd545848be8a66126a71dc69dd6d23bc4 node2:6379 myself,master - <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span> connected 0-5460
</span></span><span style=display:flex><span>1f6ed2478b461539f76b0b627de2e1b8565df719 node3:6379 master - <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1428949629272</span> <span style=color:#ae81ff>2</span> connected 5461-10922</span></span></pre></div><p>Every single node knows about others, so the previous command can be executed on any node.</p><h1 id=benchmarks class="text-4xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Benchmarks
<a href=#benchmarks>#</a></h1><p>Let&rsquo;s setup <a class="text-blue-500 hover:underline" href=https://github.com/antirez/redis-rb-cluster target=_blank rel="noreferrer nofollow"><code>redis-rb-cluster</code></a></p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>$ wget https://github.com/antirez/redis-rb-cluster/archive/master.zip
</span></span><span style=display:flex><span>$ unzip master.zip
</span></span><span style=display:flex><span>$ cd redis-rb-cluster-master</span></span></pre></div><p>We have the file <code>example.rb</code> which is pretty boring itself. It just writes random keys into our cluster and prints them:</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>$ ruby example.rb
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>...</span></span></pre></div><p>Another example is more interesting.</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>$ ruby consistency-test.rb node1 <span style=color:#ae81ff>6379</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>850</span> R <span style=color:#f92672>(</span><span style=color:#ae81ff>0</span> err<span style=color:#f92672>)</span> | <span style=color:#ae81ff>850</span> W <span style=color:#f92672>(</span><span style=color:#ae81ff>0</span> err<span style=color:#f92672>)</span> |
</span></span><span style=display:flex><span><span style=color:#ae81ff>4682</span> R <span style=color:#f92672>(</span><span style=color:#ae81ff>0</span> err<span style=color:#f92672>)</span> | <span style=color:#ae81ff>4682</span> W <span style=color:#f92672>(</span><span style=color:#ae81ff>0</span> err<span style=color:#f92672>)</span> |
</span></span><span style=display:flex><span><span style=color:#ae81ff>8490</span> R <span style=color:#f92672>(</span><span style=color:#ae81ff>0</span> err<span style=color:#f92672>)</span> | <span style=color:#ae81ff>8490</span> W <span style=color:#f92672>(</span><span style=color:#ae81ff>0</span> err<span style=color:#f92672>)</span> |
</span></span><span style=display:flex><span><span style=color:#ae81ff>12196</span> R <span style=color:#f92672>(</span><span style=color:#ae81ff>0</span> err<span style=color:#f92672>)</span> | <span style=color:#ae81ff>12196</span> W <span style=color:#f92672>(</span><span style=color:#ae81ff>0</span> err<span style=color:#f92672>)</span> |
</span></span><span style=display:flex><span><span style=color:#ae81ff>15785</span> R <span style=color:#f92672>(</span><span style=color:#ae81ff>0</span> err<span style=color:#f92672>)</span> | <span style=color:#ae81ff>15785</span> W <span style=color:#f92672>(</span><span style=color:#ae81ff>0</span> err<span style=color:#f92672>)</span> |</span></span></pre></div><p>This tool writes a huge amount of data to Redis and check whether previously written data is still there.</p><h1 id=testing-the-failover class="text-4xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Testing the failover
<a href=#testing-the-failover>#</a></h1><p>This chapter is something that I still don&rsquo;t understand. I have tried to reproduce it many times and every time I have the same result.</p><p>Run <code>consistency-test.rb</code> again and kill any other node.</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>$ src/redis-cli -h node2 debug segfault</span></span></pre></div><p>And here is the output that I&rsquo;m getting every time:</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>70273 R (0 err) | 70273 W (0 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 9515 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: Too many Cluster redirections? (last error: MOVED 9515 127.0.0.1:7002)
</span></span><span style=display:flex><span>72378 R (1 err) | 72378 W (1 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 9650 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: Too many Cluster redirections? (last error: MOVED 9650 127.0.0.1:7002)
</span></span><span style=display:flex><span>72379 R (2 err) | 72379 W (2 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 5797 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: Too many Cluster redirections? (last error: MOVED 5797 127.0.0.1:7002)
</span></span><span style=display:flex><span>72380 R (3 err) | 72380 W (3 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 9772 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: Too many Cluster redirections? (last error: MOVED 9772 127.0.0.1:7002)
</span></span><span style=display:flex><span>72384 R (4 err) | 72384 W (4 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 10245 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: Too many Cluster redirections? (last error: MOVED 10245 127.0.0.1:7002)
</span></span><span style=display:flex><span>72385 R (5 err) | 72385 W (5 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 7376 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: Too many Cluster redirections? (last error: MOVED 7376 127.0.0.1:7002)
</span></span><span style=display:flex><span>72385 R (6 err) | 72385 W (6 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 6781 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: Too many Cluster redirections? (last error: MOVED 6781 127.0.0.1:7002)
</span></span><span style=display:flex><span>72396 R (7 err) | 72396 W (7 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 10275 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: Too many Cluster redirections? (last error: MOVED 10275 127.0.0.1:7002)
</span></span><span style=display:flex><span>72401 R (8 err) | 72401 W (8 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 8639 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: Too many Cluster redirections? (last error: MOVED 8639 127.0.0.1:7002)
</span></span><span style=display:flex><span>72402 R (9 err) | 72402 W (9 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 8173 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: Too many Cluster redirections? (last error: MOVED 8173 127.0.0.1:7002)
</span></span><span style=display:flex><span>72402 R (10 err) | 72402 W (10 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 9525 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: Too many Cluster redirections? (last error: MOVED 9525 127.0.0.1:7002)
</span></span><span style=display:flex><span>72403 R (11 err) | 72403 W (11 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 9346 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: Too many Cluster redirections? (last error: MOVED 9346 127.0.0.1:7002)
</span></span><span style=display:flex><span>72406 R (12 err) | 72406 W (12 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 6391 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: Too many Cluster redirections? (last error: MOVED 6391 127.0.0.1:7002)
</span></span><span style=display:flex><span>72411 R (13 err) | 72411 W (13 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 6353 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: Too many Cluster redirections? (last error: MOVED 6353 127.0.0.1:7002)
</span></span><span style=display:flex><span>72413 R (14 err) | 72413 W (14 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 10245 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: Too many Cluster redirections? (last error: MOVED 10245 127.0.0.1:7002)
</span></span><span style=display:flex><span>72418 R (15 err) | 72418 W (15 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 6438 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: Too many Cluster redirections? (last error: MOVED 6438 127.0.0.1:7002)
</span></span><span style=display:flex><span>72422 R (16 err) | 72422 W (16 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 6826 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: Too many Cluster redirections? (last error: MOVED 6826 127.0.0.1:7002)
</span></span><span style=display:flex><span>72423 R (17 err) | 72423 W (17 err) |
</span></span><span style=display:flex><span>Reading: Too many Cluster redirections? (last error: MOVED 9713 127.0.0.1:7002)
</span></span><span style=display:flex><span>Writing: CLUSTERDOWN The cluster is down
</span></span><span style=display:flex><span>Reading: CLUSTERDOWN The cluster is down
</span></span><span style=display:flex><span>Reading: CLUSTERDOWN The cluster is down
</span></span><span style=display:flex><span>Writing: CLUSTERDOWN The cluster is down
</span></span><span style=display:flex><span>72423 R (295 err) | 72423 W (295 err) |
</span></span><span style=display:flex><span>72423 R (2219 err) | 72423 W (2219 err) |
</span></span><span style=display:flex><span>Reading: CLUSTERDOWN The cluster is down
</span></span><span style=display:flex><span>Writing: CLUSTERDOWN The cluster is down
</span></span><span style=display:flex><span>Reading: CLUSTERDOWN The cluster is down
</span></span><span style=display:flex><span>Writing: CLUSTERDOWN The cluster is down
</span></span><span style=display:flex><span>72423 R (4186 err) | 72423 W (4186 err) |
</span></span><span style=display:flex><span>Reading: CLUSTERDOWN The cluster is down
</span></span><span style=display:flex><span>Writing: CLUSTERDOWN The cluster is down
</span></span><span style=display:flex><span>72423 R (6190 err) | 72423 W (6190 err) |
</span></span><span style=display:flex><span>Writing: CLUSTERDOWN The cluster is down
</span></span><span style=display:flex><span>72423 R (8207 err) | 72423 W (8207 err) |
</span></span><span style=display:flex><span>Reading: CLUSTERDOWN The cluster is down
</span></span><span style=display:flex><span>Reading: CLUSTERDOWN The cluster is down
</span></span><span style=display:flex><span>Writing: CLUSTERDOWN The cluster is down</span></span></pre></div><p>As you can see, the cluster goes down and errors amount quickly increases. After all this steps I&rsquo;m getting broken cluster (and each separated node is broken, too)</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>$src/redis-cli -h node3 ping
</span></span><span style=display:flex><span>PONG
</span></span><span style=display:flex><span>$src/redis-cli -h node3 get <span style=color:#e6db74>&#39;test&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>error<span style=color:#f92672>)</span> CLUSTERDOWN The cluster is down</span></span></pre></div><p>The cluster goes up after booting the first node manually</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span><span style=color:#75715e># booting node2 manually...</span>
</span></span><span style=display:flex><span>$ src/redis-cli -h  get qwe
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>error<span style=color:#f92672>)</span> MOVED <span style=color:#ae81ff>757</span> 127.0.0.1:7001
</span></span><span style=display:flex><span>$ src/redis-cli -p <span style=color:#ae81ff>7001</span> get qwe
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>nil<span style=color:#f92672>)</span></span></span></pre></div><p>I hope this will be fixed soon.</p><h1 id=conclusion class="text-4xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Conclusion
<a href=#conclusion>#</a></h1><p>According to <a class="text-blue-500 hover:underline" href=https://github.com/antirez/redis-rb-cluster#redis-rb-cluster target=_blank rel="noreferrer nofollow">the repository</a>
there are still a lot of things that need to be done before using Redis Cluster in production, but I would like to say Thanks to all contributors of Redis, <code>redis-rb</code> and <code>redis-rb-cluster</code>. Good job and looking forward to use in the real-world!</p><h1 id=links class="text-4xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Links
<a href=#links>#</a></h1><ul><li><p><a class="text-blue-500 hover:underline" href=http://redis.io/topics/cluster-tutorial target=_blank rel="noreferrer nofollow">official tutorial</a></p></li><li><p><a class="text-blue-500 hover:underline" href=http://redis.io/topics/cluster-spec target=_blank rel="noreferrer nofollow">cluster specification</a></p></li><li><p><a class="text-blue-500 hover:underline" href=https://raw.githubusercontent.com/antirez/redis/3.0/00-RELEASENOTES target=_blank rel="noreferrer nofollow">changelog</a></p></li></ul></main><br><footer><script type=module defer>
  const copyToClipboard = (e) => {
    const button = e.target;
    const src = button.nextElementSibling.textContent
    navigator.clipboard.writeText(src)

    const originalText = button.innerText
    button.innerText = "copied!"
    setTimeout(() => {
      button.innerText = originalText
    }, 1500);
  }

  Array.from(document.querySelectorAll("[data-copy]")).forEach(button => {
    button.addEventListener("click", copyToClipboard)
  })
</script></footer></body></html>