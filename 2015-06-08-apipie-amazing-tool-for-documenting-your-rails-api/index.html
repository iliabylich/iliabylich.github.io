<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=cache-control content="max-age=0"><meta http-equiv=cache-control content="no-cache"><meta http-equiv=expires content="0"><meta http-equiv=expires content="Tue, 01 Jan 1980 1:00:00 GMT"><meta http-equiv=pragma content="no-cache"><link rel=apple-touch-icon-precomposed sizes=192x192 href=/icon-192x192.png><link rel="shortcut icon" href=/favicon.ico><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload href="https://fonts.googleapis.com/css2?family=Inter&display=swap" onload='this.onload=null,this.rel="stylesheet",this.removeAttribute("as")' as=style><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Inter&display=swap"></noscript><meta name=description content="Apipie - amazing tool for documenting your Rails API"><title>Apipie - amazing tool for documenting your Rails API</title>





<link rel="stylesheet" href="/css/main.c8826345ad7ba562c619be2596e20207fe470ef61aecf9db4c6405371222040f.css" integrity="sha256-yIJjRa17pWLGGb4lluICB/5HDvYa7PnbTGQFNxIiBA8=" crossorigin="anonymous">





</head><body class="m-auto px-4 xl:pl-80 font-inter dark:bg-gray-900 text-black dark:text-gray-400"><nav class="pt-5 pb-5"><ul class="flex flex-row items-center justify-start"><li class=pr-3><a class="text-blue-500 hover:underline dark:text-blue-300" href=/>Home</a></li><li class=pr-3><a class="text-blue-500 hover:underline dark:text-blue-300" href=https://github.com/iliabylich>GitHub</a></li><li class=pr-3><a class="text-blue-500 hover:underline dark:text-blue-300" href=https://twitter.com/IlyaBylich>Twitter</a></li><li class=pr-3><a class="text-blue-500 hover:underline dark:text-blue-300" href=mailto:ibylich@gmail.com>Email me</a></li><li class=pr-3><a class="text-blue-500 hover:underline dark:text-blue-300" href=/index.xml>RSS</a></li></ul></nav><div class=pb-2><h1 class="font-bold text-2xl pb-5">Apipie - amazing tool for documenting your Rails API</h1><span>Jun 8, 2015</span></div><aside class="relative bg-gray-200 border-1 p-6 border-black dark:bg-gray-800 xl:dark:bg-transparent xl:fixed xl:left-1 xl:top-1 xl:w-80 xl:bg-transparent xl:border-0 xl:text-xs"><a class="block hover:underline pl-0" href=#apipie>Apipie
</a><a class="block hover:underline pl-0" href=#features>Features
</a><a class="block hover:underline pl-4" href=#gathering-information-from-your-routes>Gathering information from your routes
</a><a class="block hover:underline pl-4" href=#api-versioning>API versioning
</a><a class="block hover:underline pl-4" href=#parameters-typing>Parameters typing
</a><a class="block hover:underline pl-4" href=#parameters-validation>Parameters validation
</a><a class="block hover:underline pl-4" href=#concerns>Concerns
</a><a class="block hover:underline pl-4" href=#specs-recording>Specs recording
</a><a class="block hover:underline pl-4" href=#other-features>Other features
</a><a class="block hover:underline pl-0" href=#customization>Customization
</a><a class="block hover:underline pl-4" href=#extracting-docs-to-mixins>Extracting docs to mixins
</a><a class="block hover:underline pl-4" href=#the-power-of-ruby-based-doc>The power of ruby-based doc
</a><a class="block hover:underline pl-4" href=#ability-to-define-default-documentation-for-all-actions-in-resource>Ability to define default documentation for all actions in resource
</a><a class="block hover:underline pl-0" href=#demo>Demo
</a><a class="block hover:underline pl-0" href=#conclusion>Conclusion</a></aside><main><h1 id=apipie class="text-4xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Apipie
<a href=#apipie>#</a></h1><p>This article is about <a class="text-blue-500 hover:underline" href=https://github.com/Apipie/apipie-rails target=_blank rel="noreferrer nofollow">Apipie gem</a>
which provides a DSL for documenting your API. I will try to cover features that I personally use on my project.</p><p>Comparing to other tools for generating API documentation (<code>yardoc</code>, <code>sdoc</code>) I would say that the main thing that you gain with Apipie is that your documentation is a real ruby code, so you can write computations, concerns etc.</p><p>Here is a simple example of how it looks in code:</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UsersController</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>ApplicationController</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  resource_description <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    formats <span style=color:#f92672>[</span><span style=color:#e6db74>:json</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    api_versions <span style=color:#e6db74>&#39;public&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  api <span style=color:#e6db74>:POST</span>, <span style=color:#e6db74>&#39;/users&#39;</span> <span style=color:#e6db74>&#39;Create user&#39;</span>
</span></span><span style=display:flex><span>  description <span style=color:#e6db74>&#39;Create user with specifed user params&#39;</span>
</span></span><span style=display:flex><span>  param <span style=color:#e6db74>:user</span>, <span style=color:#66d9ef>Hash</span>, <span style=color:#e6db74>desc</span>: <span style=color:#e6db74>&#39;User information&#39;</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    param <span style=color:#e6db74>:full_name</span>, String, <span style=color:#e6db74>desc</span>: <span style=color:#e6db74>&#39;Full name of the user&#39;</span>
</span></span><span style=display:flex><span>    param <span style=color:#e6db74>:age</span>, <span style=color:#66d9ef>Fixnum</span>, <span style=color:#e6db74>desc</span>: <span style=color:#e6db74>&#39;Age of the user&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Some application code</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></pre></div><p>So, you invoke a DSL from Apipie before your action method and it automatically comes to generated docs.</p><h1 id=features class="text-4xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Features
<a href=#features>#</a></h1><h2 id=gathering-information-from-your-routes class="text-2xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Gathering information from your routes
<a href=#gathering-information-from-your-routes>#</a></h2><p>In the example above we have passed an HTTP verb and a path of this action. We don&rsquo;t have to do it! Instead, we can simply write:</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>api! <span style=color:#e6db74>&#39;Some description&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># other docs here...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></pre></div><p>It automatically takes information from your routes that look like</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>resources <span style=color:#e6db74>:users</span>, <span style=color:#e6db74>only</span>: <span style=color:#f92672>[</span><span style=color:#e6db74>:create</span><span style=color:#f92672>]</span></span></span></pre></div><h2 id=api-versioning class="text-2xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">API versioning
<a href=#api-versioning>#</a></h2><p>You can pass versions of your API that include this endpoint on</p><ol><li>resource level (as in example)</li><li>action level (in pretty much the same way, <code>api_versions ...</code></li></ol><h2 id=parameters-typing class="text-2xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Parameters typing
<a href=#parameters-typing>#</a></h2><p>As you can see, in the first example we had 3 types:</p><ol><li><code>Hash</code></li><li><code>Array</code></li><li><code>Fixnum</code></li></ol><p>Apipie has also:
4. <code>Enum</code>
5. <code>Regexp</code></p><h2 id=parameters-validation class="text-2xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Parameters validation
<a href=#parameters-validation>#</a></h2><p>We have already typed parameters, so why do we ignore it and write custom <code>before_action</code>-s for validating parameters manually? This feature is enabled by default, but if you don&rsquo;t think that it&rsquo;s a good idea to validate your parameters through documenting tool, just pass</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>config<span style=color:#f92672>.</span>validate <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span></span></span></pre></div><p>The creator of the gem told me that &lsquo;People either love it or don&rsquo;t understand why it&rsquo;s even there&rsquo;, so it&rsquo;s up to you to decide if you need it.</p><h2 id=concerns class="text-2xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Concerns
<a href=#concerns>#</a></h2><p>I would say that it does not work as people usually expect.</p><p><code>Apipie::DSL::Concern</code> allows you to document actions that are defined in concerns.</p><p><a class="text-blue-500 hover:underline" href=https://github.com/Apipie/apipie-rails#concerns target=_blank rel="noreferrer nofollow">A quick example</a></p><p>Usually people think that it allows you to extract documentation from your controller in order to not mix code with documentation and application logic. And, to be honest, I think so too. The workaround for doing this goes below in the sections &lsquo;Extracting docs to mixins&rsquo;</p><h2 id=specs-recording class="text-2xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Specs recording
<a href=#specs-recording>#</a></h2><p>Are you tired of writing examples manually? Me too :) With Apipie you can record request/response pairs to separated YAML file and display them in generated HTML. Pass <code>:show_in_doc</code> to metadata of your RSpec example and enjoy. Apipie embeds a module for recording requests to <code>ActionController::TestCase::Behavior</code> which is the core of all requests specs for RSpec and Minitest (yes, both of them delegate performing requests internally to <code>ActionController::TestCase::Behavior</code> - <a class="text-blue-500 hover:underline" href=https://github.com/rspec/rspec-rails/blob/master/lib/rspec/rails/example/controller_example_group.rb#L12 target=_blank rel="noreferrer nofollow">source</a>
).</p><h2 id=other-features class="text-2xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Other features
<a href=#other-features>#</a></h2><p>There is a plenty of other things in Apipie that are very cool, by I did not have a chance to use it yet.</p><ol><li>Localization. Currently it supports English, Russian, Chinese and Brazilian. If you want to add support for your language, use this as an example - <a class="text-blue-500 hover:underline" href=https://github.com/Apipie/apipie-rails/blob/master/config/locales/en.yml target=_blank rel="noreferrer nofollow">source</a></li><li>Disqus integration. This is extremely useful when you have a decentralized team. If you have any questions - just leave a comment and wait for response! No need to define any models for storing users/comments/relations, everything is in the cloud.</li><li>Custom markup processors. Not sure that anyone can need it, default markup processor looks very stable.</li></ol><h1 id=customization class="text-4xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Customization
<a href=#customization>#</a></h1><p>Some of these items can be difficult to explain, if you have any questions after reading it, just google it, answers for all of them should be in ruby docs (or ping me if you still don&rsquo;t get it).</p><h2 id=extracting-docs-to-mixins class="text-2xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Extracting docs to mixins
<a href=#extracting-docs-to-mixins>#</a></h2><p>This is the main question I have got after reading official README. I don&rsquo;t want to mix documentation and application logic. First of all we need to understand how exactly Apipie builds mapping between action names and compiled DSL. Even without reading source code the only guess that we may have is <code>method_added</code> hook. Every time when you define a method (on instance or on class, it does not matter), Ruby automatically fires <code>method_added</code> method on your class.</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestClass</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>.</span><span style=color:#a6e22e>method_added</span>(method_name)
</span></span><span style=display:flex><span>    puts <span style=color:#e6db74>&#34;Added method </span><span style=color:#e6db74>#{</span>method_name<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>method1</span>; <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>method2</span>; <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#75715e># =&gt; Added method method1</span>
</span></span><span style=display:flex><span><span style=color:#75715e># =&gt; Added method method2</span></span></span></pre></div><p>So, the algorithm is like this:</p><ol><li>You invoke method <code>api</code> (or <code>api!</code>)</li><li>Apipie internally saves action name (let&rsquo;s say, as <code>Apipie.current_action_name</code>) and arguments (in <code>Apipie.current_action_data</code>, for example)</li><li>You invoke other DSL methods</li><li>Apipie appends this data to <code>Apipie.current_action_data</code></li><li>You define a method (action in our case)</li><li>Apipie adds mapping <code>Apipie.current_action_name => Apipie.current_action_data</code> to a global Hash like <code>Apipie.all_docs</code></li><li>When you visit <code>/docs</code>, Apipie displays all data from <code>Apipie.all_docs</code></li></ol><p>And if it&rsquo;s true we can write something like:</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span><span style=color:#75715e># app/docs/users_doc.rb</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>module</span> UsersDoc
</span></span><span style=display:flex><span>  <span style=color:#75715e># we need the DSL, right?</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>extend</span> <span style=color:#66d9ef>Apipie</span><span style=color:#f92672>::</span><span style=color:#66d9ef>DSL</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Concern</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  api <span style=color:#e6db74>:GET</span>, <span style=color:#e6db74>&#39;/users&#39;</span>, <span style=color:#e6db74>&#39;List users&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>show</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Nothing here, it&#39;s just a stub</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># app/controller/users_controller.rb</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UsersController</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>ApplicationController</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>include</span> <span style=color:#66d9ef>UsersDoc</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>show</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Application code goes here</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># and it overrides blank method</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># from the module</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></pre></div><p>And yes, it works! Let&rsquo;s add resource description</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span><span style=color:#66d9ef>module</span> UsersDoc
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>extend</span> <span style=color:#66d9ef>Apipie</span><span style=color:#f92672>::</span><span style=color:#66d9ef>DSL</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Concern</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  resource_description <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    formats <span style=color:#f92672>[</span><span style=color:#e6db74>:json</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    api_versions <span style=color:#e6db74>&#39;public&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></pre></div><p>Which breaks it&mldr;</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>Apipie: Can not resolve resource UsersDoc name.</span></span></pre></div><p>Yes, because our resource is <code>UsersController</code>. The error happens in the following lines in Apipie source code:</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_resource_name</span>(klass)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> klass<span style=color:#f92672>.</span>class <span style=color:#f92672>==</span> String
</span></span><span style=display:flex><span>        klass
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>elsif</span> @controller_to_resource_id<span style=color:#f92672>.</span>has_key?(klass)
</span></span><span style=display:flex><span>        @controller_to_resource_id<span style=color:#f92672>[</span>klass<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>elsif</span> <span style=color:#66d9ef>Apipie</span><span style=color:#f92672>.</span>configuration<span style=color:#f92672>.</span>namespaced_resources? <span style=color:#f92672>&amp;&amp;</span> klass<span style=color:#f92672>.</span>respond_to?(<span style=color:#e6db74>:controller_path</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span> <span style=color:#66d9ef>if</span> klass <span style=color:#f92672>==</span> <span style=color:#66d9ef>ActionController</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Base</span>
</span></span><span style=display:flex><span>        path <span style=color:#f92672>=</span> klass<span style=color:#f92672>.</span>controller_path
</span></span><span style=display:flex><span>        path<span style=color:#f92672>.</span>gsub(version_prefix(klass), <span style=color:#e6db74>&#34;&#34;</span>)<span style=color:#f92672>.</span>gsub(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#e6db74>&#34;-&#34;</span>)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>elsif</span> klass<span style=color:#f92672>.</span>respond_to?(<span style=color:#e6db74>:controller_name</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span> <span style=color:#66d9ef>if</span> klass <span style=color:#f92672>==</span> <span style=color:#66d9ef>ActionController</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Base</span>
</span></span><span style=display:flex><span>        klass<span style=color:#f92672>.</span>controller_name
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#e6db74>&#34;Apipie: Can not resolve resource </span><span style=color:#e6db74>#{</span>klass<span style=color:#e6db74>}</span><span style=color:#e6db74> name.&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span></span></span></pre></div><p>Most of this code does not really matter, the thing is that Apipie does not know what to do with module <code>UsersDoc</code>. It has no <code>resource_id</code>, let&rsquo;s define it.</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>resource_description <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  resource_id <span style=color:#e6db74>&#39;Users&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># other dsl</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></pre></div><p>Now we get an error</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span>undefined method <span style=color:#e6db74>`superclass&#39; for UsersDoc:Module</span></span></span></pre></div><p>But&mldr; Module (I mean, an instance of Module class) can&rsquo;t have a parent class. It&rsquo;s a module!</p><p>Forget that you are a ruby developer and define a method called <code>superclass</code> on your module :)</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span><span style=color:#75715e># before calling DSL</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>.</span><span style=color:#a6e22e>superclass</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>UsersController</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></pre></div><p>So, from this moment</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span><span style=color:#66d9ef>UsersDoc</span><span style=color:#f92672>.</span>superclass <span style=color:#f92672>==</span> <span style=color:#66d9ef>UsersController</span>
</span></span><span style=display:flex><span><span style=color:#75715e># =&gt; true</span></span></span></pre></div><p>Refresh the page with documentation and see that it finally works!
Here is a gist with a full code that wraps ugly code and blank methods:
<a class="text-blue-500 hover:underline" href=https://gist.github.com/iliabylich/c8032b193405673062e7 target=_blank rel="noreferrer nofollow">full gist</a></p><h2 id=the-power-of-ruby-based-doc class="text-2xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">The power of ruby-based doc
<a href=#the-power-of-ruby-based-doc>#</a></h2><p>Imagine the following scenario:</p><p>I have two versions of API. When I was young and stupid, I implemented the first one (<code>v1</code>). And it has an authentication by plain username and password (in headers). Few years later something changed in my mind and I created another one (<code>v2</code>) which has token-based authentication.</p><p>First API contains 100 actions in 10 controllers, so does the second one, too. To make a documentation I have to copy-paste 2 lines of code 200 times (to put it for every action) or 20 times (to put it to every resource).</p><p>Instead of repeated copying the real description of authentication mechanism it would be really nice to have something like</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span><span style=color:#75715e># for Api::V1</span>
</span></span><span style=display:flex><span>auth_with <span style=color:#e6db74>:password</span>
</span></span><span style=display:flex><span><span style=color:#75715e># for Api::V2</span>
</span></span><span style=display:flex><span>auth_with <span style=color:#e6db74>:token</span></span></span></pre></div><p>And describe authentication in a more declarative way. In order to make it we need to add our own method to DSL. Here is what it may look like:</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span><span style=color:#66d9ef>module</span> BaseDoc
</span></span><span style=display:flex><span>  <span style=color:#75715e># ... code from the gist</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>AUTH_METHODS</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>password</span>: <span style=color:#66d9ef>Api</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Auth</span><span style=color:#f92672>::</span><span style=color:#66d9ef>PasswordDoc</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>token</span>: <span style=color:#66d9ef>Api</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Auth</span><span style=color:#f92672>::</span><span style=color:#66d9ef>TokenDoc</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>auth_with</span>(auth_method)
</span></span><span style=display:flex><span>    mod <span style=color:#f92672>=</span> <span style=color:#66d9ef>AUTH_METHODS</span><span style=color:#f92672>[</span>auth_method<span style=color:#f92672>]</span> <span style=color:#f92672>or</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>raise</span> <span style=color:#e6db74>&#34;Unknown auth strategy </span><span style=color:#e6db74>#{</span>auth_method<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    send(<span style=color:#e6db74>:include</span>, mod)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># app/docs/api/auth/password_doc.rb</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>module</span> Api::Auth::PasswordDoc
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>.</span><span style=color:#a6e22e>included</span>(base)
</span></span><span style=display:flex><span>    base<span style=color:#f92672>.</span>instance_eval <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># documentation of password-</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#  based authentication</span>
</span></span><span style=display:flex><span>      header <span style=color:#e6db74>:username</span>, <span style=color:#e6db74>required</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      header <span style=color:#e6db74>:password</span>, <span style=color:#e6db74>required</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      error <span style=color:#e6db74>code</span>: <span style=color:#ae81ff>401</span>, <span style=color:#e6db74>desc</span>: <span style=color:#e6db74>&#39;Unauthorized&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># app/docs/api/auth/token_doc.rb</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>module</span> Api::Auth::TokenDoc
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>.</span><span style=color:#a6e22e>included</span>(base)
</span></span><span style=display:flex><span>    base<span style=color:#f92672>.</span>instance_eval <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># documentation of token-</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#  based authentication</span>
</span></span><span style=display:flex><span>      header <span style=color:#e6db74>&#39;Token&#39;</span>, <span style=color:#e6db74>&#39;Your API token&#39;</span>
</span></span><span style=display:flex><span>      error <span style=color:#e6db74>code</span>: <span style=color:#ae81ff>401</span>, <span style=color:#e6db74>desc</span>: <span style=color:#e6db74>&#39;Token is requried&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></pre></div><p>And from now we can write</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span><span style=color:#66d9ef>module</span> Api::V1::UsersDoc
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>extend</span> <span style=color:#66d9ef>BaseDoc</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  doc_for <span style=color:#e6db74>:show</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    auth_with <span style=color:#e6db74>:password</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># or</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># auth_with :token</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></pre></div><h2 id=ability-to-define-default-documentation-for-all-actions-in-resource class="text-2xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Ability to define default documentation for all actions in resource
<a href=#ability-to-define-default-documentation-for-all-actions-in-resource>#</a></h2><p>So, we have a <code>resource_description</code> and <code>api</code> methods, but how can we define common parts for all of our actions? I hate copy-paste driven development, let&rsquo;s write a DSL for this.</p><p>We want to have a <code>defaults</code> method which takes a block and executes it for each action.</p><div class="group relative"><button class="hidden group-hover:inline absolute top-0.5 right-0.5 bg-gray-200 p-2 hover:bg-gray-400" data-copy=true>copy</button><pre class="bg-neutral-800 text-white p-4"><span style=display:flex><span><span style=color:#66d9ef>module</span> BaseDoc
</span></span><span style=display:flex><span>  <span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>defaults</span>(<span style=color:#f92672>&amp;</span>block)
</span></span><span style=display:flex><span>    @defaults <span style=color:#f92672>=</span> block
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>doc_for</span>(action_name, <span style=color:#f92672>&amp;</span>block)
</span></span><span style=display:flex><span>    instance_eval(<span style=color:#f92672>&amp;</span>block)
</span></span><span style=display:flex><span>    <span style=color:#75715e># Only the next line added</span>
</span></span><span style=display:flex><span>    instance_eval(<span style=color:#f92672>&amp;</span>@defaults) <span style=color:#66d9ef>if</span> @defaults
</span></span><span style=display:flex><span>    api_version namespace_name <span style=color:#66d9ef>if</span> namespace_name
</span></span><span style=display:flex><span>    define_method(action_name) <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># ... define it in your controller with the real code</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></pre></div><p>So, we just store passed block and invoke it. This example is much simpler then the previous one.</p><h1 id=demo class="text-4xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Demo
<a href=#demo>#</a></h1><p><a class="text-blue-500 hover:underline" href=https://github.com/iliabylich/apipie-demo target=_blank rel="noreferrer nofollow">URL</a></p><p>You can click by statically generated docs (thanks to GitHub pages):</p><ul><li><a class="text-blue-500 hover:underline" href=http://iliabylich.github.io/apipie-demo/doc/apidoc/private_v1.html target=_blank rel="noreferrer nofollow"><code>Private::V1</code></a></li><li><a class="text-blue-500 hover:underline" href=http://iliabylich.github.io/apipie-demo/doc/apidoc/private_v2.html target=_blank rel="noreferrer nofollow"><code>Private::V2</code></a></li><li><a class="text-blue-500 hover:underline" href=http://iliabylich.github.io/apipie-demo/doc/apidoc/public.html target=_blank rel="noreferrer nofollow"><code>Public</code></a></li></ul><h1 id=conclusion class="text-4xl border-b-2 mt-8 mb-2 border-black dark:border-gray-400">Conclusion
<a href=#conclusion>#</a></h1><p>Apipie is an amazing library and its most significant advantage is that you document ruby using ruby (being a ruby developer), which gives you ability to define custom behaviors and scenarios. I can&rsquo;t even imagine myself writing API docs using <code>yardoc</code> (however, I use it to document plain ruby classes).</p><p>If you have any bugs (or ideas to implement), please, <a class="text-blue-500 hover:underline" href=https://github.com/Apipie/apipie-rails/issues target=_blank rel="noreferrer nofollow">create an issue on GitHub</a>
, let&rsquo;s make it even better!</p></main><br><footer><script type=module defer>
  const copyToClipboard = (e) => {
    const button = e.target;
    const src = button.nextElementSibling.textContent
    navigator.clipboard.writeText(src)

    const originalText = button.innerText
    button.innerText = "copied!"
    setTimeout(() => {
      button.innerText = originalText
    }, 1500);
  }

  Array.from(document.querySelectorAll("[data-copy]")).forEach(button => {
    button.addEventListener("click", copyToClipboard)
  })
</script></footer></body></html>